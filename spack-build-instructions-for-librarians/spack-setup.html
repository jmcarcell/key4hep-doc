<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setting up Spack &mdash; Key4hep  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/panels.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Talks and Presentations" href="../talks-and-presentations/README.html" />
    <link rel="prev" title="Building Key4hep: For Librarians" href="README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Key4hep
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setup-and-getting-started/README.html">Getting started with Key4hep software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup-and-getting-started/README.html#setting-up-the-key4hep-software-stack">Setting up the Key4hep Software Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-central-installations-on-cvmfs">Using central installations on cvmfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-virtual-machines-or-docker-containers">Using Virtual Machines or Docker containers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup-and-getting-started/README.html#cernvm-virtual-appliance">CernVM Virtual Appliance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html">Using the Key4hep-Stack for CLIC Simulation and Reconstruction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#reconstruction">Reconstruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#reconstruction-with-marlin">Reconstruction with Marlin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#reconstruction-with-gaudi-through-k4marlinwrapper">Reconstruction with Gaudi through k4MarlinWrapper</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#reconstruction-with-lcio-input">Reconstruction with LCIO input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/Readme.html#reconstruction-with-edm4hep-input">Reconstruction with EDM4hep input</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html">Event Data Model converters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html#reading-events">Reading events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html#writing-events">Writing events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html#id1">Event Data Model converters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html#edm4hep-to-lcio-converter">EDM4hep to LCIO converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/edmConverters.html#lcio-to-edm4hep-converter">LCIO to EDM4hep converter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/howtoMultithread.html">How to run multithreading with k4MarlinWrapper (Gaudi)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/howtoMultithread.html#running-gaudi-with-multithreading-support">Running Gaudi with multithreading support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/howtoMultithread.html#how-to-run-with-inter-event-parallelism">How to run with inter-event parallelism</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/howtoMultithread.html#running-example">Running example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.html">Running an Event Display with EDM4hep input</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.html#setting-up-an-environment">Setting up an environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.html#creating-an-input-file">Creating an input file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.html#runing-the-event-display">Runing the event display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.html#creating-a-gaudi-options-file">Creating a Gaudi options file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html">Running Delphes fast simulation with EDM4hep output</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#setup-and-prerequisites">Setup and prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#standalone-executables">Standalone executables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#other-standalone-executables">Other standalone executables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#usage-in-the-key4hep-framework">Usage in the Key4hep framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing-key4hep-software/README.html">Developing Key4hep</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html">Github workflow and contribution guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#first-time-setup-of-git">First time setup of git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#generate-and-set-up-ssh-keys-for-github">Generate and set up ssh keys for github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#improving-your-git-experience">Improving your git experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#development-workflow">Development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#keeping-your-local-repository-up-to-date">Keeping your local repository up to date</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#contributing-code">Contributing code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#recommendations">Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#general-recommendations">General recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#commit-comments">Commit comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#cleaning-history">Cleaning history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#pull-requests">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#trouble-shooting">Trouble-shooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#when-i-try-to-push-to-the-repository-i-get-an-authentication-error">When I try to push to the repository, I get an authentication error</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#i-have-cloned-with-https-and-now-i-can-t-push-my-changes-what-do-i-do">I have cloned with https and now I can’t push my changes, what do I do?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#need-help">Need help?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html">CMake guide for Key4hep software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#quick-start-into-building-key4hep-software">Quick start into building Key4hep Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#set-up-the-environment">Set up the environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#running-cmake">Running CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#using-your-local-installation">Using your local installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#cmake-example-packages">CMake example packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#changing-the-cmake-configuration">Changing the CMake Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#runtime-environment">Runtime Environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#ctest-in-key4hep">CTest in Key4hep</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#customizing-how-cmake-is-run">Customizing how CMake is run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html">Writing Gaudi Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html#exercise-adding-an-algorithm">Exercise: Adding an Algorithm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html">Building Key4hep using Spack: For Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#developing-a-single-package">Developing a single package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#installing-a-local-version-with-dev-build">Installing a local version with <code class="docutils literal notranslate"><span class="pre">dev-build</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#using-the-local-version-as-dependency">Using the local version as dependency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#more-advanced-usage">More advanced usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#developing-multiple-packages-or-dependencies-of-other-packages">Developing multiple packages or dependencies of other packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#using-an-environment-to-setup-all-dependencies">Using an environment to setup all dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/SpackForDevelopers.html#environments-and-a-development-workflow">Environments and a development workflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Building Key4hep: For Librarians</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setting up Spack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#downloading-a-spack-instance">Downloading a spack instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-spack">Configuring Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-spack">Installing Spack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-key4hep-package-recipes">Installing the key4hep package recipes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-packages-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-upstreams-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">upstreams.yaml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-an-upstream-compiler">Setting up an upstream compiler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../talks-and-presentations/README.html">Talks and Presentations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../talks-and-presentations/README.html#upcoming-talks-and-workshops">Upcoming Talks and Workshops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../call-for-logos/README.html">Call for logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/fccsw">FCC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/CLIC/CLICSoftwareComputing">CLIC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ilcsoft.desy.de/portal">ILC software</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cepcsoft.ihep.ac.cn/">CEPC software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Key4hep</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">Building Key4hep: For Librarians</a></li>
      <li class="breadcrumb-item active">Setting up Spack</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/key4hep/key4hep-doc/blob/master/spack-build-instructions-for-librarians/spack-setup.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setting-up-spack">
<h1>Setting up Spack<a class="headerlink" href="#setting-up-spack" title="Permalink to this headline"></a></h1>
<section id="downloading-a-spack-instance">
<h2>Downloading a spack instance<a class="headerlink" href="#downloading-a-spack-instance" title="Permalink to this headline"></a></h2>
<p>On centos7 machines with cvmfs, the easiest way to set up spack is to simply clone the key4hep fork, and use one of the provided spack “environments”, that is spack configuration that is created automatically from the current key4hep/key4hep-spack repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/key4hep/spack
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/key4hep/key4hep-spack
<span class="nb">source</span><span class="w"> </span>spack/share/spack/setup-env.sh
spack<span class="w"> </span>env<span class="w"> </span>activate<span class="w"> </span>key4hep-spack/environments/key4hep-release-user
</pre></div>
</div>
<p>This sets up spack with a suitable compiler from cvmfs, the key4hep package recipes and the location of the upstream installation on cvmfs so packages can be installed on top:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list already installed (&quot;upstream&quot;) packages</span>
spack<span class="w"> </span>find<span class="w"> </span>-p
<span class="c1"># install a package locally, using suitable upstream packages as dependencies</span>
spack<span class="w"> </span>install<span class="w"> </span>edm4hep@master
<span class="c1"># load individual packages in the environment</span>
spack<span class="w"> </span>load<span class="w"> </span>cmake
spack<span class="w"> </span>load<span class="w"> </span>gcc
<span class="c1"># load the whole software </span>
spack<span class="w"> </span>load<span class="w"> </span>key4hep-stack
</pre></div>
</div>
</section>
<section id="configuring-spack">
<h2>Configuring Spack<a class="headerlink" href="#configuring-spack" title="Permalink to this headline"></a></h2>
<p>Alternatively, and for other platforms, spack can be configured in a few steps. These steps are essentially what is used to create the pre-configured spack instance in this script: https://github.com/key4hep/key4hep-spack/blob/master/scripts/ci_setup_spack.sh</p>
<p>While this still puts the configuration files in the global scope of spack, it is recommended to use them in an environment, as provided by key4hep-spack.</p>
<section id="installing-spack">
<h3>Installing Spack<a class="headerlink" href="#installing-spack" title="Permalink to this headline"></a></h3>
<p>Spack itself is very easy to install -  simply clone the repository with git.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/key4hep/spack.git
<span class="nb">source</span><span class="w"> </span>spack/share/spack/setup-env.sh
</pre></div>
</div>
</section>
<section id="installing-the-key4hep-package-recipes">
<h3>Installing the key4hep package recipes<a class="headerlink" href="#installing-the-key4hep-package-recipes" title="Permalink to this headline"></a></h3>
<p>The spack repository for key4hep packages is installed the same way:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/key4hep/key4hep-spack.git
spack repo add key4hep-spack
</pre></div>
</div>
</section>
</section>
<section id="configuring-packages-yaml">
<h2>Configuring <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code><a class="headerlink" href="#configuring-packages-yaml" title="Permalink to this headline"></a></h2>
<p>In order to choose the right package versions and build options, spack sometimes needs a few <a class="reference external" href="https://spack.readthedocs.io/en/latest/build_settings.html">hints and nudges</a>. With the new concretizer (default as of spack version 0.17) this should be mostly obsolete.
key4hep-spack ships a spack config file that should give a good build customization out of the box, but can also be customized further. It just needs to be copied to the configuration where spack searches for configurations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp key4hep-spack/environments/key4hep-common/packages.yaml spack/etc/spack/
</pre></div>
</div>
<section id="configuring-upstreams-yaml">
<h3>Configuring <code class="docutils literal notranslate"><span class="pre">upstreams.yaml</span></code><a class="headerlink" href="#configuring-upstreams-yaml" title="Permalink to this headline"></a></h3>
<p>The cvmfs installation can be used as an “upstream installation”, by adding the following configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="s">&lt;&lt;EOT &gt;&gt; spack/etc/spack/upstreams.yaml</span>
<span class="s">upstreams:</span>
<span class="s">  spack-instance-1:</span>
<span class="s">      install_tree: /cvmfs/sw.hsf.org/spackages/</span>
<span class="s">EOT</span>
</pre></div>
</div>
</section>
<section id="setting-up-an-upstream-compiler">
<h3>Setting up an upstream compiler<a class="headerlink" href="#setting-up-an-upstream-compiler" title="Permalink to this headline"></a></h3>
<p>Often it is practical to use a compiler already installed upstream. Spack provides the <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">find</span></code> command for this, but the compiler needs to be loaded into the PATH:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading the compiler from upstream</span>
spack<span class="w"> </span>load<span class="w"> </span>gcc
spack<span class="w"> </span>compiler<span class="w"> </span>find<span class="w"> </span>--scope<span class="w"> </span>site
</pre></div>
</div>
<p>Now, the full stack can be installed locally by simply doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install the meta-package for the key4hep-stack</span>
spack<span class="w"> </span>install<span class="w"> </span>key4hep-stack
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="README.html" class="btn btn-neutral float-left" title="Building Key4hep: For Librarians" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../talks-and-presentations/README.html" class="btn btn-neutral float-right" title="Talks and Presentations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Key4hep.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>