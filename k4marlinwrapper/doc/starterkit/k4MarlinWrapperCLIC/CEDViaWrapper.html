<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running an Event Display with EDM4hep input &mdash; Key4hep  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/panels.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="../../../../_static/panels.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Running Delphes fast simulation with EDM4hep output" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html" />
    <link rel="prev" title="How to run multithreading with k4MarlinWrapper (Gaudi)" href="howtoMultithread.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> Key4hep
            <img src="../../../../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../setup-and-getting-started/README.html">Getting started with Key4hep software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../setup-and-getting-started/README.html#setting-up-the-key4hep-software-stack">Setting up the Key4hep Software Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../setup-and-getting-started/README.html#using-central-installations-on-cvmfs">Using central installations on cvmfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../setup-and-getting-started/README.html#using-virtual-machines-or-docker-containers">Using Virtual Machines or Docker containers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../setup-and-getting-started/README.html#cernvm-virtual-appliance">CernVM Virtual Appliance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Readme.html">Using the Key4hep-Stack for CLIC Simulation and Reconstruction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Readme.html#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Readme.html#reconstruction">Reconstruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Readme.html#reconstruction-with-marlin">Reconstruction with Marlin</a></li>
<li class="toctree-l3"><a class="reference internal" href="Readme.html#reconstruction-with-gaudi-through-k4marlinwrapper">Reconstruction with Gaudi through k4MarlinWrapper</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Readme.html#reconstruction-with-lcio-input">Reconstruction with LCIO input</a></li>
<li class="toctree-l4"><a class="reference internal" href="Readme.html#reconstruction-with-edm4hep-input">Reconstruction with EDM4hep input</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="edmConverters.html">Event Data Model converters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="edmConverters.html#reading-events">Reading events</a></li>
<li class="toctree-l2"><a class="reference internal" href="edmConverters.html#writing-events">Writing events</a></li>
<li class="toctree-l2"><a class="reference internal" href="edmConverters.html#id1">Event Data Model converters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="edmConverters.html#edm4hep-to-lcio-converter">EDM4hep to LCIO converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="edmConverters.html#lcio-to-edm4hep-converter">LCIO to EDM4hep converter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="howtoMultithread.html">How to run multithreading with k4MarlinWrapper (Gaudi)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="howtoMultithread.html#running-gaudi-with-multithreading-support">Running Gaudi with multithreading support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="howtoMultithread.html#how-to-run-with-inter-event-parallelism">How to run with inter-event parallelism</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="howtoMultithread.html#running-example">Running example</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running an Event Display with EDM4hep input</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-an-environment">Setting up an environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-input-file">Creating an input file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#runing-the-event-display">Runing the event display</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-gaudi-options-file">Creating a Gaudi options file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html">Running Delphes fast simulation with EDM4hep output</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#setup-and-prerequisites">Setup and prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#standalone-executables">Standalone executables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#other-standalone-executables">Other standalone executables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html#usage-in-the-key4hep-framework">Usage in the Key4hep framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developing-key4hep-software/README.html">Developing Key4hep</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html">Github workflow and contribution guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#first-time-setup-of-git">First time setup of git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#generate-and-set-up-ssh-keys-for-github">Generate and set up ssh keys for github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#improving-your-git-experience">Improving your git experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#development-workflow">Development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#keeping-your-local-repository-up-to-date">Keeping your local repository up to date</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#contributing-code">Contributing code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#recommendations">Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#general-recommendations">General recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#commit-comments">Commit comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#cleaning-history">Cleaning history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#pull-requests">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#trouble-shooting">Trouble-shooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#when-i-try-to-push-to-the-repository-i-get-an-authentication-error">When I try to push to the repository, I get an authentication error</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#i-have-cloned-with-https-and-now-i-can-t-push-my-changes-what-do-i-do">I have cloned with https and now I can’t push my changes, what do I do?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepSoftwareGit.html#need-help">Need help?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html">CMake guide for Key4hep software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#quick-start-into-building-key4hep-software">Quick start into building Key4hep Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#set-up-the-environment">Set up the environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#running-cmake">Running CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#using-your-local-installation">Using your local installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#cmake-example-packages">CMake example packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#changing-the-cmake-configuration">Changing the CMake Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#runtime-environment">Runtime Environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#ctest-in-key4hep">CTest in Key4hep</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/Key4hepCMakeGuide.html#customizing-how-cmake-is-run">Customizing how CMake is run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developing-key4hep-software/WritingAlgorithms.html">Writing Gaudi Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/WritingAlgorithms.html#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/WritingAlgorithms.html#exercise-adding-an-algorithm">Exercise: Adding an Algorithm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html">Building Key4hep using Spack: For Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#developing-a-single-package">Developing a single package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#installing-a-local-version-with-dev-build">Installing a local version with <code class="docutils literal notranslate"><span class="pre">dev-build</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#using-the-local-version-as-dependency">Using the local version as dependency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#more-advanced-usage">More advanced usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#developing-multiple-packages-or-dependencies-of-other-packages">Developing multiple packages or dependencies of other packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#using-an-environment-to-setup-all-dependencies">Using an environment to setup all dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../developing-key4hep-software/SpackForDevelopers.html#environments-and-a-development-workflow">Environments and a development workflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/README.html">Building Key4hep: For Librarians</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html">Setting up Spack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#downloading-a-spack-instance">Downloading a spack instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#configuring-spack">Configuring Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#installing-spack">Installing Spack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#installing-the-key4hep-package-recipes">Installing the key4hep package recipes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#configuring-packages-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#configuring-upstreams-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">upstreams.yaml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spack-build-instructions-for-librarians/spack-setup.html#setting-up-an-upstream-compiler">Setting up an upstream compiler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../talks-and-presentations/README.html">Talks and Presentations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../talks-and-presentations/README.html#upcoming-talks-and-workshops">Upcoming Talks and Workshops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../call-for-logos/README.html">Call for logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/fccsw">FCC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/CLIC/CLICSoftwareComputing">CLIC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ilcsoft.desy.de/portal">ILC software</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cepcsoft.ihep.ac.cn/">CEPC software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Key4hep</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Running an Event Display with EDM4hep input</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/key4hep/key4hep-doc/blob/master/k4marlinwrapper/doc/starterkit/k4MarlinWrapperCLIC/CEDViaWrapper.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-an-event-display-with-edm4hep-input">
<h1>Running an Event Display with EDM4hep input<a class="headerlink" href="#running-an-event-display-with-edm4hep-input" title="Permalink to this headline"></a></h1>
<p>It is possible to run the <a class="reference external" href="https://github.com/iLCSoft/CED">C Event Display (CED)</a> via a wrapped <a class="reference external" href="https://github.com/iLCSoft/CEDViewer">CEDViewer</a> Marlin Processor. This makes it possible to run the Event Dispaly with EDM4hep input files using an on the fly conversion to LCIO for CED. This introduction shows the basic concepts and also provides a options file that should work for most use cases. This example will be using the CLIC detector but should also work for other DD4hep detector models. The example is fully self contained, if you already have everything set up you can jump directly to <span class="xref myst">running the event display</span>.</p>
<section id="setting-up-an-environment">
<h2>Setting up an environment<a class="headerlink" href="#setting-up-an-environment" title="Permalink to this headline"></a></h2>
<p>The following steps have been tested with the Key4hep nightly builds release which can be setup using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/cvmfs/sw-nightlies.hsf.org/key4hep/setup.sh
</pre></div>
</div>
<p>To get the CLIC detecor description we clone the <code class="docutils literal notranslate"><span class="pre">CLICPerformance</span></code> repository</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/iLCSoft/CLICPerformance
</pre></div>
</div>
<p>All the following steps assume that the environment is setup like above and that the detector description is in the <code class="docutils literal notranslate"><span class="pre">CLICPerformance</span></code> directory. All commands start from the diretory from which <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> has been executed.</p>
</section>
<section id="creating-an-input-file">
<h2>Creating an input file<a class="headerlink" href="#creating-an-input-file" title="Permalink to this headline"></a></h2>
<p>To create an input file for the event display we run a simple detector simulation using <code class="docutils literal notranslate"><span class="pre">ddsim</span></code> and a particle gun that shoots photons. The input file that we create here for illustration purposes has only 10 events, which also means that the creation should only take a few minutes. The steps to create this file are the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ddsim<span class="w"> </span>--steeringFile<span class="w"> </span>CLICPerformance/clicConfig/clic_steer.py<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--compactFile<span class="w"> </span><span class="nv">$LCGEO</span>/CLIC/compact/CLIC_o3_v14/CLIC_o3_v14.xml<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--enableGun<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--gun.distribution<span class="w"> </span>uniform<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--gun.particle<span class="w"> </span>gamma<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--gun.energy<span class="w"> </span><span class="m">10</span>*GeV<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--outputFile<span class="w"> </span>gamma_10GeV_edm4hep.root<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--numberOfEvents<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
<p>You should now have a <code class="docutils literal notranslate"><span class="pre">gamma_10GeV_edm4hep.root</span></code> file containing 10 events.</p>
</section>
<section id="runing-the-event-display">
<h2>Runing the event display<a class="headerlink" href="#runing-the-event-display" title="Permalink to this headline"></a></h2>
<p>In order to run the event display via the <code class="docutils literal notranslate"><span class="pre">DDCEDViewer</span></code> we use the Marlin wrapper and attach an EDM4hep to LCIO converter to the wrapped processor. In the following we will build the complete Gaudi options file step by step. Here we simply present the most important steps, but do not go over all details of the <code class="docutils literal notranslate"><span class="pre">DDCEDViewer</span></code> configuration, for that it is probably best to directly look at the <a class="reference external" href="https://github.com/iLCSoft/CEDViewer">CEDViewer repository</a> directly. The complete Gaudi configuration can be found in <a class="reference external" href="https://github.com/key4hep/k4MarlinWrapper/blob/master/k4MarlinWrapper/examples/event_display.py"><code class="docutils literal notranslate"><span class="pre">k4MarlinWrapper/examples/event_display.py</span></code></a> which is also installed at <code class="docutils literal notranslate"><span class="pre">$K4MARLINWRAPPER/examples/event_display.py</span></code></p>
<p>To read EDM4hep input we use the <code class="docutils literal notranslate"><span class="pre">PodioInput</span></code> module and the <code class="docutils literal notranslate"><span class="pre">k4DataSvc</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Gaudi.Configuration</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">k4DataSvc</span><span class="p">,</span> <span class="n">PodioInput</span>

<span class="n">algList</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">evtsvc</span> <span class="o">=</span> <span class="n">k4DataSvc</span><span class="p">(</span><span class="s1">&#39;EventDataSvc&#39;</span><span class="p">)</span>
<span class="n">evtsvc</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">inp</span> <span class="o">=</span> <span class="n">PodioInput</span><span class="p">(</span><span class="s1">&#39;InputReader&#39;</span><span class="p">)</span>
<span class="n">inp</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="p">[</span>
   <span class="c1"># ... all collections that should be read ...</span>
<span class="p">]</span>

<span class="n">algList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DDCEDViewer</span></code> also requires setting up a DD4hep geometry, which can simply be done by wrapping the <code class="docutils literal notranslate"><span class="pre">InitializeDD4hep</span></code> Marlin Processor</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">MarlinProcessorWrapper</span>

<span class="n">MyInitializeDD4hep</span> <span class="o">=</span> <span class="n">MarlinProcessorWrapper</span><span class="p">(</span><span class="s2">&quot;MyInitializeDD4hep&quot;</span><span class="p">)</span>
<span class="n">MyInitializeDD4hep</span><span class="o">.</span><span class="n">OutputLevel</span> <span class="o">=</span> <span class="n">INFO</span>
<span class="n">MyInitializeDD4hep</span><span class="o">.</span><span class="n">ProcessorType</span> <span class="o">=</span> <span class="s2">&quot;InitializeDD4hep&quot;</span>
<span class="n">MyInitializeDD4hep</span><span class="o">.</span><span class="n">Parameters</span> <span class="o">=</span> <span class="p">{</span>
                                 <span class="s2">&quot;DD4hepXMLFile&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CLICPerformance/Visualisation/CLIC_o3_v06_CED/CLIC_o3_v06_CED.xml&quot;</span><span class="p">]</span>
                                 <span class="p">}</span>
                                 
<span class="n">algList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MyInitializeDD4hep</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in this case we already have passed in the geometry that we want to use for the event display.</p>
<p>Finally, the main work is done by the <code class="docutils literal notranslate"><span class="pre">DDCEDViewer</span></code>, which we again use via the <code class="docutils literal notranslate"><span class="pre">MarlinProcessorWrapper</span></code> (omitting a lot of the detailed configuration here). In order to convert the EDM4hep inputs to LCIO we attach an <code class="docutils literal notranslate"><span class="pre">EDM4hep2LcioTool</span></code> to this algorithm</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">EDM4hep2LcioTool</span>

<span class="n">MyCEDViewer</span> <span class="o">=</span> <span class="n">MarlinProcessorWrapper</span><span class="p">(</span><span class="s2">&quot;MyCEDViewer&quot;</span><span class="p">)</span>
<span class="n">MyCEDViewer</span><span class="o">.</span><span class="n">OutputLevel</span> <span class="o">=</span> <span class="n">INFO</span>
<span class="n">MyCEDViewer</span><span class="o">.</span><span class="n">ProcessorType</span> <span class="o">=</span> <span class="s2">&quot;DDCEDViewer&quot;</span>
<span class="n">MyCEDViewer</span><span class="o">.</span><span class="n">Parameters</span> <span class="o">=</span> <span class="p">{</span>
                          <span class="c1"># ... lots of CEDViewer configuration ...</span>
                          <span class="p">}</span>
                          
<span class="c1"># EDM4hep to LCIO converter</span>
<span class="n">edmConvTool</span> <span class="o">=</span> <span class="n">EDM4hep2LcioTool</span><span class="p">(</span><span class="s2">&quot;EDM4hep2lcio&quot;</span><span class="p">)</span>
<span class="n">edmConvTool</span><span class="o">.</span><span class="n">convertAll</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">edmConvTool</span><span class="o">.</span><span class="n">collNameMapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MCParticles&#39;</span><span class="p">:</span> <span class="s1">&#39;MCParticle&#39;</span><span class="p">}</span>
<span class="n">edmConvTool</span><span class="o">.</span><span class="n">OutputLevel</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">MyCEDViewer</span><span class="o">.</span><span class="n">EDM4hep2LcioTool</span> <span class="o">=</span> <span class="n">edmConvTool</span>

<span class="n">algList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MyCEDViewer</span><span class="p">)</span>
</pre></div>
</div>
<p>The only thing that is left to do now is to put everything into the <code class="docutils literal notranslate"><span class="pre">ApplicationManager</span></code> in order to run things</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">ApplicationMgr</span>
<span class="n">ApplicationMgr</span><span class="p">(</span> <span class="n">TopAlg</span> <span class="o">=</span> <span class="n">algList</span><span class="p">,</span>
                <span class="n">EvtSel</span> <span class="o">=</span> <span class="s1">&#39;NONE&#39;</span><span class="p">,</span>
                <span class="n">EvtMax</span>   <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">ExtSvc</span> <span class="o">=</span> <span class="p">[</span><span class="n">evtsvc</span><span class="p">],</span>
                <span class="n">OutputLevel</span><span class="o">=</span><span class="n">INFO</span>
              <span class="p">)</span>
</pre></div>
</div>
<p>With all these pieces put together (as in <code class="docutils literal notranslate"><span class="pre">examples/event_display.py</span></code>) it is no possible to run the event display. In order to run the event display we first have to start the <code class="docutils literal notranslate"><span class="pre">glced</span></code> server program to which the wrapped <code class="docutils literal notranslate"><span class="pre">CEDViewer</span></code> processor will then connect. Starting the server and running the wrapped processor can be done via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>glced<span class="w"> </span><span class="p">&amp;</span>

k4run<span class="w"> </span><span class="nv">$K4MARLINWRAPPER</span>/examples/event_display.py<span class="w"> </span>--EventDataSvc.input<span class="o">=</span>gamma_10GeV_edm4hep.root
</pre></div>
</div>
</section>
<section id="creating-a-gaudi-options-file">
<h2>Creating a Gaudi options file<a class="headerlink" href="#creating-a-gaudi-options-file" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">event_display.py</span></code> options file that is used above and that is present in the examples has been produced following these steps:</p>
<ul class="simple">
<li><p>Using an <code class="docutils literal notranslate"><span class="pre">.slcio</span></code> input file and the desired geometry, run <code class="docutils literal notranslate"><span class="pre">ced2go</span></code> with the desired arguments.</p>
<ul>
<li><p>This produces a Marlin xml steering file on the fly and stores it at <code class="docutils literal notranslate"><span class="pre">/tmp/ced2go_${USER}_steering.xml</span></code></p></li>
</ul>
</li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">convertMarlinSteeringToGaudi.py</span></code> converter script convert this into a gaudi options file</p></li>
<li><p>Exchange the LCIO input reading by the podio input reading (see above)</p></li>
<li><p>Attach the <code class="docutils literal notranslate"><span class="pre">EDM4hep2LcioTool</span></code> to the wrapped <code class="docutils literal notranslate"><span class="pre">CEDViewer</span></code> processor</p></li>
</ul>
<p>This should allow one to arrive at a similar steering file even for slightly different configurations. One potential pitfall is the slightly different naming of the <code class="docutils literal notranslate"><span class="pre">ddsim</span></code> outputs between LCIO and EDM4hep (see <a class="reference external" href="https://github.com/AIDASoft/DD4hep/issues/921">this issue</a>). This can be addressed by configuring the EDM4hep to LCIO converter (<code class="docutils literal notranslate"><span class="pre">edmConvTool</span></code> in the code above) to map the names accordingly.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="howtoMultithread.html" class="btn btn-neutral float-left" title="How to run multithreading with k4MarlinWrapper (Gaudi)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../../k4simdelphes/doc/starterkit/k4SimDelphes/Readme.html" class="btn btn-neutral float-right" title="Running Delphes fast simulation with EDM4hep output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Key4hep.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>